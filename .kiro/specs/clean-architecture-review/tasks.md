# Implementation Plan

- [x] 1. プロジェクト構造の基礎分析とセットアップ
  - プロジェクトのディレクトリ構造を詳細に分析し、規則書で定義された理想的な構造と比較する
  - 各ファイルの配置場所と命名規則を検証するためのベースライン情報を収集する
  - レビュー結果を格納するためのデータ構造とレポート形式を定義する
  - _Requirements: 6.2, 6.3_

- [x] 2. ドメイン層の実装レビューと評価
  - [x] 2.1 エンティティの外部フレームワーク依存性チェック
    - User、Channel、Messageエンティティの実装を分析し、React/Next.js/Prismaへの直接依存がないことを確認する
    - プロパティゲッター（`get id()`）の使用状況を検証し、`getId()`のようなメソッド名の使用を特定する
    - エンティティ内のビジネスロジックが適切に実装されているかを評価する
    - _Requirements: 1.1_

  - [x] 2.2 バリューオブジェクトの実装パターン検証
    - EmailクラスとBranded Type（UserId、ChannelId、MessageId）の実装を詳細に分析する
    - 不変性の保証と値の妥当性検証が適切に実装されているかを確認する
    - バリューオブジェクトの境界安全性が担保されているかを評価する
    - _Requirements: 1.2_

  - [x] 2.3 時刻依存とClockインターフェースの評価
    - Clockインターフェースの定義と実装（SystemClock）を確認する
    - エンティティやドメインサービスでの時刻依存ロジックが注入可能になっているかを検証する
    - 時刻に依存するビジネスルール（メッセージ編集可能時間など）の実装を評価する
    - _Requirements: 1.3_

  - [x] 2.4 リポジトリポートとドメインエラーの検証
    - リポジトリインターフェースの定義がドメイン層に配置されているかを確認する
    - 戻り値のnullがNotFoundのみに限定されているかを検証する
    - DomainError基底クラスとその派生クラス（ValidationError、NotFoundError等）の階層構造を評価する
    - _Requirements: 1.4, 1.5_

- [x] 3. アプリケーション層の実装レビューと評価
  - [x] 3.1 UseCaseのフレームワーク非依存性検証
    - GetChannelsUseCase、SendMessageUseCase等のUseCaseクラスを分析する
    - React/Next.js/Prismaへの直接依存がないことを確認する
    - UseCaseがドメイン層のポート（インターフェース）のみに依存しているかを検証する
    - _Requirements: 2.1_

  - [x] 3.2 依存関係の方向性と境界の確認
    - アプリケーション層からドメイン層への依存関係を確認する
    - インフラストラクチャ層への直接依存がないことを検証する
    - 依存関係の逆転原則が適切に適用されているかを評価する
    - _Requirements: 2.2_

  - [x] 3.3 DTO、マッパー、エラーハンドリングの評価
    - DTO（ChannelDto、MessageDto等）とマッパー（ChannelMapper、MessageMapper等）の実装を分析する
    - ドメインオブジェクトとDTOの境界が明確に定義されているかを確認する
    - ドメインエラーの処理と上位層への伝播が適切に実装されているかを検証する
    - ファクトリパターンの使用状況を確認し、複雑なオブジェクト生成の抽象化を評価する
    - _Requirements: 2.3, 2.4, 2.5_

- [x] 4. インフラストラクチャ層の実装レビューと評価
  - [x] 4.1 Prismaリポジトリの実装パターン検証
    - PrismaUserRepositoryの実装を詳細に分析する
    - PrismaClientがコンストラクタで注入されているかを確認する
    - ドメインポートの実装が正しく行われているかを検証する
    - _Requirements: 3.1_

  - [x] 4.2 データマッピングと外部サービス実装の評価
    - Prismaのデータベースエンティティとドメインオブジェクト間の変換を分析する
    - 外部サービス（AuthService等）のポート実装を確認する
    - データベース固有の詳細がドメイン層に漏れていないかを検証する
    - _Requirements: 3.2, 3.3_

  - [x] 4.3 ファイル命名規則とServer/Client境界の検証
    - 実装アダプタが技術を接尾辞に含む命名規則（PrismaUserRepository.ts等）に従っているかを確認する
    - PrismaアクセスがServer専用で実装されているかを検証する
    - Client側でHTTPアダプタが使用されているかを確認する
    - _Requirements: 3.4, 3.5_

- [x] 5. UI層の実装レビューと評価
  - [x] 5.1 Server/Client Component分離の検証
    - Server Component（ページコンポーネント等）がserverContainerを使用してUseCaseを直接実行しているかを確認する
    - Client ComponentがServer Actionsを通じてデータを取得しているかを検証する
    - Server/Client境界が適切に分離されているかを評価する
    - _Requirements: 4.1, 4.2_

  - [x] 5.2 UI HookとComposition Rootの評価
    - UI Hook（useChannels等）がui/ディレクトリに配置されているかを確認する
    - HookがServer ActionsまたはHTTPアダプタを使用してデータを取得しているかを検証する
    - Root Layout（app/layout.tsx）がComposition Rootの起点として適切に機能しているかを評価する
    - _Requirements: 4.3, 4.4_

  - [x] 5.3 ファイル配置規則の準拠検証
    - UIコンポーネントとHookがui/ディレクトリに適切に配置されているかを確認する
    - app/ディレクトリがNext.js App Routerのみに使用されているかを検証する
    - ファイル構造が規則書で定義された理想的な構造に準拠しているかを評価する
    - _Requirements: 4.5_

- [x] 6. 依存性注入の実装レビューと評価
  - [x] 6.1 Server/Client DIコンテナの分離検証
    - serverContainerがPrisma実装をバインドし、サーバ専用のDIコンテナとして機能しているかを確認する
    - clientContainerの存在と、HTTPアダプタ実装のバインドを検証する
    - DIコンテナの分離が適切に実装されているかを評価する
    - _Requirements: 5.1, 5.2_

  - [x] 6.2 環境変数による実装切り替えとテスト用DIの評価
    - USE_PRISMAなどの環境変数でPrisma実装とMock実装が適切に切り替えられるかを確認する
    - テスト時にモック実装を注入可能な設計になっているかを検証する
    - Composition Rootでの依存関係の解決が適切な場所で行われているかを評価する
    - _Requirements: 5.3, 5.4, 5.5_

- [x] 7. テスト戦略と命名規則の包括的評価
  - [x] 7.1 テスト実装の規則書準拠確認
    - ユニットテスト（Domain/Application/Infrastructure）の実装状況を分析する
    - 統合テストの実装と規則書の方針との整合性を確認する
    - テスト用のモックやスタブの使用状況を検証する
    - _Requirements: 6.1_

  - [x] 7.2 命名規則とインポート順序の一貫性検証
    - ファイル名、クラス名、関数名がPascalCase/camelCase/UPPER_SNAKE_CASEの規則に従っているかを確認する
    - インポート文が規定順序（Node標準→外部ライブラリ→domain→application→infrastructure→ui→types→styles）に従っているかを検証する
    - 命名規則の一貫性を全プロジェクトにわたって評価する
    - _Requirements: 6.2, 6.3_

- [x] 8. アーキテクチャ違反の特定と改善提案の作成
  - [x] 8.1 依存関係違反と層責任分離の問題特定
    - 依存関係の方向や層の責任分離に関する違反箇所を特定する
    - 各違反の重要度（critical/major/minor/info）を評価し、優先度を設定する
    - 違反の根本原因を分析し、パターン化された問題を特定する
    - _Requirements: 6.4_

  - [x] 8.2 具体的な改善提案と実装例の作成
    - 各問題に対する具体的な解決策を規則書のパターンに基づいて提示する
    - 修正前後のコード例を含む詳細な実装ガイドを作成する
    - 改善項目を影響度と実装難易度に基づいて優先順位付けする
    - _Requirements: 6.5_

- [x] 9. 移行計画の策定と最終レポートの作成
  - [x] 9.1 段階的移行チェックリストの作成
    - 現在の実装から規則書準拠の実装への移行チェックリストを作成する
    - PR分割計画、フォルダ移動順、型エラー解消順を含む詳細な移行手順を定義する
    - 各移行ステップのリスクと対策を評価する
    - _Requirements: 6.6_

  - [x] 9.2 包括的レビューレポートの作成
    - 全6カテゴリーのレビュー結果を統合した包括的なレポートを作成する
    - カテゴリー別の準拠度スコア、重要な発見事項、推奨アクションを含める
    - 実装品質の向上に向けた具体的なロードマップを提示する
    - プロジェクトチームが実行可能な優先順位付けされたアクションプランを提供する
    - _Requirements: 6.5, 6.6_
